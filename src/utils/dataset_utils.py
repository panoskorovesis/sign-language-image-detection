import os
import numpy as np
from PIL import Image
from tqdm import tqdm

def load_dataset(directory, use_preprocessed=False, verbose=False) -> tuple:
    """
    Load all the images as X and all the labels as Y
    
    The labels are given by the folder the image is present in
    NOTE: This dataset contains two folders
    1) Normal Images
    2) Pre-processed images. These are generated by the original ones by binary threshold conversion
    
    Set verbose=True to enable prints
    """
    X = []
    Y = []
    
    if verbose:
        print('Will load the images and their labels')
    
    for root, dirs, files in tqdm(os.walk(directory)):
        for file in files:
            img_path = os.path.join(root, file)
            if use_preprocessed:
                if "Pre-Processed" in img_path:
                    X.append(Image.open(img_path))
                    Y.append(img_path.split('/')[-2])
            else:
                if "Pre-Processed" not in img_path:
                    X.append(Image.open(img_path))
                    Y.append(img_path.split('/')[-2])
    
    # Finally convert the images to np arrays
    if verbose:
        print('Will convert the images to numpy and return them')
    return np.array(X), np.array(Y)